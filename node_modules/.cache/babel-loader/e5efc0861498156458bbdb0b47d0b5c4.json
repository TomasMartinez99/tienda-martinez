{"ast":null,"code":"var _jsxFileName = \"C:\\\\wamp64\\\\www\\\\tienda-martinez\\\\src\\\\components\\\\cart\\\\Form.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport { database } from \"../../firebase/firebase\";\nimport firebase from \"firebase/app\";\nimport \"firebase/firestore\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const Form = ({\n  aggregateItems,\n  itemsPrice,\n  clear\n}) => {\n  _s();\n\n  const [name, setName] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [mail, setMail] = useState(\"\");\n  const [redirect, setRedirect] = useState(false);\n  const [orderNumber, setOrderNumber] = useState(\"\");\n\n  const createOrder = e => {\n    e.preventDefault();\n    const itemsToUpdate = dataBase.collection(\"items\").where(firebase.firestore.FieldPath.documentId(), \"in\", items.map(i => i.item.id));\n    itemsToUpdate.get().then(querySnapshot => {\n      const batch = dataBase.batch();\n      const outOfStock = [];\n      querySnapshot.docs.forEach((docSnapshot, idx) => {\n        if (docSnapshot.data().stock >= items[idx].quantity) {\n          batch.update(docSnapshot.ref, {\n            stock: docSnapshot.data().stock - items[idx].quantity\n          });\n        } else {\n          outOfStock.push({ ...docSnapshot.data(),\n            id: docSnapshot.id\n          });\n        }\n      });\n\n      if (outOfStock.length === 0) {\n        const newOrderReference = dataBase.collection(\"orders\").doc();\n        batch.set(newOrderReference, {\n          date: firebase.firestore.Timestamp.fromDate(new Date())\n        });\n        batch.commit().then(() => {\n          dataBase.collection(\"orders\") // .orderBy('date', \"asc\").limitToLast(1)\n          .orderBy(\"date\", \"desc\").limit(1).get().then(querySnapshot => console.log(querySnapshot.docs[0].id));\n        });\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: redirect ? alert(`Orden realizada con éxito ${orderNumber}`) : /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: createOrder,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Nombre:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: name,\n          onChange: e => setName(e.target.value),\n          placeholder: \"Tomas Martinez\",\n          id: \"name\",\n          type: \"text\",\n          autoComplete: \"name\",\n          enterKeyHint: \"next\",\n          required: true,\n          autoFocus: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Tel\\xE9fono:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: phone,\n          onChange: e => setPhone(e.target.value),\n          placeholder: \"+54 261 542389\",\n          id: \"phone\",\n          type: \"tel\",\n          autoComplete: \"phone\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Mail:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: mail,\n          onChange: e => setMail(e.target.value),\n          placeholder: \"ejemplo@ejemplo.com\",\n          id: \"mail\",\n          type: \"email\",\n          autoComplete: \"email\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn btn-outline-success\",\n        type: \"submit\",\n        disabled: name === \"\" || phone === \"\" || mail === \"\",\n        children: \"Finalizar Compra\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(Form, \"upwIg/CtU0EgBCBbjkUIk/c0xcY=\");\n\n_c = Form;\n\nvar _c;\n\n$RefreshReg$(_c, \"Form\");","map":{"version":3,"sources":["C:/wamp64/www/tienda-martinez/src/components/cart/Form.jsx"],"names":["React","useState","database","firebase","Form","aggregateItems","itemsPrice","clear","name","setName","phone","setPhone","mail","setMail","redirect","setRedirect","orderNumber","setOrderNumber","createOrder","e","preventDefault","itemsToUpdate","dataBase","collection","where","firestore","FieldPath","documentId","items","map","i","item","id","get","then","querySnapshot","batch","outOfStock","docs","forEach","docSnapshot","idx","data","stock","quantity","update","ref","push","length","newOrderReference","doc","set","date","Timestamp","fromDate","Date","commit","orderBy","limit","console","log","alert","target","value"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport { database } from \"../../firebase/firebase\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\n\r\nexport const Form = ({ aggregateItems, itemsPrice, clear }) => {\r\n  const [name, setName] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [mail, setMail] = useState(\"\");\r\n  const [redirect, setRedirect] = useState(false);\r\n  const [orderNumber, setOrderNumber] = useState(\"\");\r\n\r\n  const createOrder = (e) => {\r\n    e.preventDefault();\r\n\r\n    const itemsToUpdate = dataBase.collection(\"items\").where(\r\n      firebase.firestore.FieldPath.documentId(),\r\n      \"in\",\r\n      items.map((i) => i.item.id)\r\n    );\r\n\r\n    itemsToUpdate.get().then((querySnapshot) => {\r\n      const batch = dataBase.batch();\r\n      const outOfStock = [];\r\n\r\n      querySnapshot.docs.forEach((docSnapshot, idx) => {\r\n        if (docSnapshot.data().stock >= items[idx].quantity) {\r\n          batch.update(docSnapshot.ref, {\r\n            stock: docSnapshot.data().stock - items[idx].quantity,\r\n          });\r\n        } else {\r\n          outOfStock.push({ ...docSnapshot.data(), id: docSnapshot.id });\r\n        }\r\n      });\r\n\r\n      if (outOfStock.length === 0) {\r\n        const newOrderReference = dataBase.collection(\"orders\").doc();\r\n        batch.set(newOrderReference, {\r\n          date: firebase.firestore.Timestamp.fromDate(new Date()),\r\n        });\r\n        batch.commit().then(() => {\r\n          dataBase\r\n            .collection(\"orders\")\r\n            // .orderBy('date', \"asc\").limitToLast(1)\r\n            .orderBy(\"date\", \"desc\")\r\n            .limit(1)\r\n            .get()\r\n            .then((querySnapshot) => console.log(querySnapshot.docs[0].id));\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {redirect ? (\r\n        alert(`Orden realizada con éxito ${orderNumber}`)\r\n      ) : (\r\n        <form onSubmit={createOrder}>\r\n          <p>\r\n            <label>Nombre:</label>\r\n            <br></br>\r\n            <input\r\n              value={name}\r\n              onChange={(e) => setName(e.target.value)}\r\n              placeholder=\"Tomas Martinez\"\r\n              id=\"name\"\r\n              type=\"text\"\r\n              autoComplete=\"name\"\r\n              enterKeyHint=\"next\"\r\n              required\r\n              autoFocus\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Teléfono:</label>\r\n            <br></br>\r\n            <input\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              placeholder=\"+54 261 542389\"\r\n              id=\"phone\"\r\n              type=\"tel\"\r\n              autoComplete=\"phone\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Mail:</label>\r\n            <br></br>\r\n            <input\r\n              value={mail}\r\n              onChange={(e) => setMail(e.target.value)}\r\n              placeholder=\"ejemplo@ejemplo.com\"\r\n              id=\"mail\"\r\n              type=\"email\"\r\n              autoComplete=\"email\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <button\r\n            className=\"btn btn-outline-success\"\r\n            type=\"submit\"\r\n            disabled={name === \"\" || phone === \"\" || mail === \"\"}\r\n          >\r\n            Finalizar Compra\r\n          </button>\r\n        </form>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}