{"ast":null,"code":"import _objectSpread from\"C:/wamp64/www/tienda-martinez/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/wamp64/www/tienda-martinez/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useContext}from\"react\";import{Redirect}from\"react-router-dom\";import{database}from\"../../firebase/firebase\";import{CartContext}from\"../../context/CartContext\";import firebase from\"firebase/app\";import\"firebase/firestore\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var Form=function Form(_ref){var aggregateItems=_ref.aggregateItems,itemsPrice=_ref.itemsPrice,clear=_ref.clear;var _useContext=useContext(CartContext),updateOrderData=_useContext.updateOrderData;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),phone=_useState4[0],setPhone=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),mail=_useState6[0],setMail=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),redirect=_useState8[0],setRedirect=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),orderNumber=_useState10[0],setOrderNumber=_useState10[1];var createOrder=function createOrder(e){e.preventDefault();var buyer={name:name,phone:phone,mail:mail};var itemsToUpdate=database.collection(\"products\").where(firebase.firestore.FieldPath.documentId(),\"in\",aggregateItems.map(function(i){return i.smartwatch.id;}));var createOrder=function createOrder(buyer){var newOrder={buyer:buyer,items:aggregateItems,date:firebase.firestore.Timestamp.fromDate(new Date()),total:itemsPrice};return newOrder;};var addNewOrder=function addNewOrder(buyer){var newOrder=createOrder(buyer);var orders=database.collection(\"orders\");try{orders.add(newOrder).then(function(doc){updateOrderData(doc.id);});}catch(error){alert(\"Error al generar la compra\");}};itemsToUpdate.get().then(function(querySnapshot){var batch=database.batch();var outOfStock=[];querySnapshot.docs.forEach(function(docSnapshot,id){if(docSnapshot.data().stock>=aggregateItems[id].itemCount){batch.update(docSnapshot.ref,{stock:docSnapshot.data().stock-aggregateItems[id].itemCount});}else{outOfStock.push(_objectSpread(_objectSpread({},docSnapshot.data()),{},{id:docSnapshot.id}));}});if(outOfStock.length===0){batch.commit().then(function(){database.collection(\"orders\").orderBy(\"date\",\"desc\").limit(1).get().then(function(querySnapshot){setOrderNumber(querySnapshot.docs[0].id);addNewOrder(buyer);setRedirect(true);clear();});});}});};return/*#__PURE__*/_jsx(_Fragment,{children:redirect?/*#__PURE__*/_jsx(Redirect,{to:\"/purchaseMade/\".concat(orderNumber)}):/*#__PURE__*/_jsxs(\"form\",{onSubmit:createOrder,children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nombre:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{value:name,onChange:function onChange(e){return setName(e.target.value);},placeholder:\"Tomas Martinez\",id:\"name\",type:\"text\",autoComplete:\"name\",enterKeyHint:\"next\",required:true,autoFocus:true})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Tel\\xE9fono:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{value:phone,onChange:function onChange(e){return setPhone(e.target.value);},placeholder:\"+54 261 542389\",id:\"phone\",type:\"tel\",autoComplete:\"phone\",enterKeyHint:\"next\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Mail:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{value:mail,onChange:function onChange(e){return setMail(e.target.value);},placeholder:\"ejemplo@ejemplo.com\",id:\"mail\",type:\"email\",autoComplete:\"email\",enterKeyHint:\"next\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-success\",type:\"submit\",disabled:name===\"\"||phone===\"\"||mail===\"\",children:\"Finalizar Compra\"})]})});};","map":{"version":3,"sources":["C:/wamp64/www/tienda-martinez/src/components/cart/Form.jsx"],"names":["React","useState","useContext","Redirect","database","CartContext","firebase","Form","aggregateItems","itemsPrice","clear","updateOrderData","name","setName","phone","setPhone","mail","setMail","redirect","setRedirect","orderNumber","setOrderNumber","createOrder","e","preventDefault","buyer","itemsToUpdate","collection","where","firestore","FieldPath","documentId","map","i","smartwatch","id","newOrder","items","date","Timestamp","fromDate","Date","total","addNewOrder","orders","add","then","doc","error","alert","get","querySnapshot","batch","outOfStock","docs","forEach","docSnapshot","data","stock","itemCount","update","ref","push","length","commit","orderBy","limit","target","value"],"mappings":"uSAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,UAA1B,KAA4C,OAA5C,CACA,OAASC,QAAT,KAAyB,kBAAzB,CACA,OAASC,QAAT,KAAyB,yBAAzB,CACA,OAASC,WAAT,KAA4B,2BAA5B,CACA,MAAOC,CAAAA,QAAP,KAAqB,cAArB,CACA,MAAO,oBAAP,C,6IAEA,MAAO,IAAMC,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,MAA2C,IAAxCC,CAAAA,cAAwC,MAAxCA,cAAwC,CAAxBC,UAAwB,MAAxBA,UAAwB,CAAZC,KAAY,MAAZA,KAAY,CAC7D,gBAA4BR,UAAU,CAACG,WAAD,CAAtC,CAAQM,eAAR,aAAQA,eAAR,CACA,cAAwBV,QAAQ,CAAC,EAAD,CAAhC,wCAAOW,IAAP,eAAaC,OAAb,eACA,eAA0BZ,QAAQ,CAAC,EAAD,CAAlC,yCAAOa,KAAP,eAAcC,QAAd,eACA,eAAwBd,QAAQ,CAAC,EAAD,CAAhC,yCAAOe,IAAP,eAAaC,OAAb,eACA,eAAgChB,QAAQ,CAAC,KAAD,CAAxC,yCAAOiB,QAAP,eAAiBC,WAAjB,eACA,eAAsClB,QAAQ,CAAC,EAAD,CAA9C,0CAAOmB,WAAP,gBAAoBC,cAApB,gBAEA,GAAMC,CAAAA,WAAW,CAAG,qBAACC,CAAD,CAAO,CACzBA,CAAC,CAACC,cAAF,GAEA,GAAMC,CAAAA,KAAK,CAAG,CACZb,IAAI,CAAEA,IADM,CAEZE,KAAK,CAAEA,KAFK,CAGZE,IAAI,CAAEA,IAHM,CAAd,CAMA,GAAMU,CAAAA,aAAa,CAAGtB,QAAQ,CAACuB,UAAT,CAAoB,UAApB,EAAgCC,KAAhC,CACpBtB,QAAQ,CAACuB,SAAT,CAAmBC,SAAnB,CAA6BC,UAA7B,EADoB,CAEpB,IAFoB,CAGpBvB,cAAc,CAACwB,GAAf,CAAmB,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACC,UAAF,CAAaC,EAApB,EAAnB,CAHoB,CAAtB,CAMA,GAAMb,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACG,KAAD,CAAW,CAC7B,GAAMW,CAAAA,QAAQ,CAAG,CACfX,KAAK,CAAEA,KADQ,CAEfY,KAAK,CAAE7B,cAFQ,CAGf8B,IAAI,CAAEhC,QAAQ,CAACuB,SAAT,CAAmBU,SAAnB,CAA6BC,QAA7B,CAAsC,GAAIC,CAAAA,IAAJ,EAAtC,CAHS,CAIfC,KAAK,CAAEjC,UAJQ,CAAjB,CAMA,MAAO2B,CAAAA,QAAP,CACD,CARD,CAUA,GAAMO,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAAClB,KAAD,CAAW,CAC7B,GAAMW,CAAAA,QAAQ,CAAGd,WAAW,CAACG,KAAD,CAA5B,CACA,GAAMmB,CAAAA,MAAM,CAAGxC,QAAQ,CAACuB,UAAT,CAAoB,QAApB,CAAf,CACA,GAAI,CACFiB,MAAM,CAACC,GAAP,CAAWT,QAAX,EAAqBU,IAArB,CAA0B,SAACC,GAAD,CAAS,CACjCpC,eAAe,CAACoC,GAAG,CAACZ,EAAL,CAAf,CACD,CAFD,EAGD,CAAC,MAAOa,KAAP,CAAc,CACdC,KAAK,CAAC,4BAAD,CAAL,CACD,CACF,CAVD,CAYAvB,aAAa,CAACwB,GAAd,GAAoBJ,IAApB,CAAyB,SAACK,aAAD,CAAmB,CAC1C,GAAMC,CAAAA,KAAK,CAAGhD,QAAQ,CAACgD,KAAT,EAAd,CACA,GAAMC,CAAAA,UAAU,CAAG,EAAnB,CAEAF,aAAa,CAACG,IAAd,CAAmBC,OAAnB,CAA2B,SAACC,WAAD,CAAcrB,EAAd,CAAqB,CAC9C,GAAIqB,WAAW,CAACC,IAAZ,GAAmBC,KAAnB,EAA4BlD,cAAc,CAAC2B,EAAD,CAAd,CAAmBwB,SAAnD,CAA8D,CAC5DP,KAAK,CAACQ,MAAN,CAAaJ,WAAW,CAACK,GAAzB,CAA8B,CAC5BH,KAAK,CAAEF,WAAW,CAACC,IAAZ,GAAmBC,KAAnB,CAA2BlD,cAAc,CAAC2B,EAAD,CAAd,CAAmBwB,SADzB,CAA9B,EAGD,CAJD,IAIO,CACLN,UAAU,CAACS,IAAX,gCAAqBN,WAAW,CAACC,IAAZ,EAArB,MAAyCtB,EAAE,CAAEqB,WAAW,CAACrB,EAAzD,IACD,CACF,CARD,EAUA,GAAIkB,UAAU,CAACU,MAAX,GAAsB,CAA1B,CAA6B,CAC3BX,KAAK,CAACY,MAAN,GAAelB,IAAf,CAAoB,UAAM,CACxB1C,QAAQ,CACLuB,UADH,CACc,QADd,EAEGsC,OAFH,CAEW,MAFX,CAEmB,MAFnB,EAGGC,KAHH,CAGS,CAHT,EAIGhB,GAJH,GAKGJ,IALH,CAKQ,SAACK,aAAD,CAAmB,CACvB9B,cAAc,CAAC8B,aAAa,CAACG,IAAd,CAAmB,CAAnB,EAAsBnB,EAAvB,CAAd,CACAQ,WAAW,CAAClB,KAAD,CAAX,CACAN,WAAW,CAAC,IAAD,CAAX,CACAT,KAAK,GACN,CAVH,EAWD,CAZD,EAaD,CACF,CA7BD,EA8BD,CAnED,CAqEA,mBACE,yBACGQ,QAAQ,cACP,KAAC,QAAD,EAAU,EAAE,yBAAmBE,WAAnB,CAAZ,EADO,cAGP,cAAM,QAAQ,CAAEE,WAAhB,wBACE,kCACE,kCADF,cAEE,aAFF,cAGE,cACE,KAAK,CAAEV,IADT,CAEE,QAAQ,CAAE,kBAACW,CAAD,QAAOV,CAAAA,OAAO,CAACU,CAAC,CAAC4C,MAAF,CAASC,KAAV,CAAd,EAFZ,CAGE,WAAW,CAAC,gBAHd,CAIE,EAAE,CAAC,MAJL,CAKE,IAAI,CAAC,MALP,CAME,YAAY,CAAC,MANf,CAOE,YAAY,CAAC,MAPf,CAQE,QAAQ,KARV,CASE,SAAS,KATX,EAHF,GADF,cAgBE,kCACE,uCADF,cAEE,aAFF,cAGE,cACE,KAAK,CAAEtD,KADT,CAEE,QAAQ,CAAE,kBAACS,CAAD,QAAOR,CAAAA,QAAQ,CAACQ,CAAC,CAAC4C,MAAF,CAASC,KAAV,CAAf,EAFZ,CAGE,WAAW,CAAC,gBAHd,CAIE,EAAE,CAAC,OAJL,CAKE,IAAI,CAAC,KALP,CAME,YAAY,CAAC,OANf,CAOE,YAAY,CAAC,MAPf,EAHF,GAhBF,cA6BE,kCACE,gCADF,cAEE,aAFF,cAGE,cACE,KAAK,CAAEpD,IADT,CAEE,QAAQ,CAAE,kBAACO,CAAD,QAAON,CAAAA,OAAO,CAACM,CAAC,CAAC4C,MAAF,CAASC,KAAV,CAAd,EAFZ,CAGE,WAAW,CAAC,qBAHd,CAIE,EAAE,CAAC,MAJL,CAKE,IAAI,CAAC,OALP,CAME,YAAY,CAAC,OANf,CAOE,YAAY,CAAC,MAPf,EAHF,GA7BF,cA0CE,eACE,SAAS,CAAC,yBADZ,CAEE,IAAI,CAAC,QAFP,CAGE,QAAQ,CAAExD,IAAI,GAAK,EAAT,EAAeE,KAAK,GAAK,EAAzB,EAA+BE,IAAI,GAAK,EAHpD,8BA1CF,GAJJ,EADF,CA0DD,CAvIM","sourcesContent":["import React, { useState, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { database } from \"../../firebase/firebase\";\r\nimport { CartContext } from \"../../context/CartContext\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\n\r\nexport const Form = ({ aggregateItems, itemsPrice, clear }) => {\r\n  const { updateOrderData } = useContext(CartContext);\r\n  const [name, setName] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [mail, setMail] = useState(\"\");\r\n  const [redirect, setRedirect] = useState(false);\r\n  const [orderNumber, setOrderNumber] = useState(\"\");\r\n\r\n  const createOrder = (e) => {\r\n    e.preventDefault();\r\n\r\n    const buyer = {\r\n      name: name,\r\n      phone: phone,\r\n      mail: mail,\r\n    };\r\n\r\n    const itemsToUpdate = database.collection(\"products\").where(\r\n      firebase.firestore.FieldPath.documentId(),\r\n      \"in\",\r\n      aggregateItems.map((i) => i.smartwatch.id)\r\n    );\r\n\r\n    const createOrder = (buyer) => {\r\n      const newOrder = {\r\n        buyer: buyer,\r\n        items: aggregateItems,\r\n        date: firebase.firestore.Timestamp.fromDate(new Date()),\r\n        total: itemsPrice,\r\n      };\r\n      return newOrder;\r\n    };\r\n\r\n    const addNewOrder = (buyer) => {\r\n      const newOrder = createOrder(buyer);\r\n      const orders = database.collection(\"orders\");\r\n      try {\r\n        orders.add(newOrder).then((doc) => {\r\n          updateOrderData(doc.id);\r\n        });\r\n      } catch (error) {\r\n        alert(\"Error al generar la compra\");\r\n      }\r\n    };\r\n\r\n    itemsToUpdate.get().then((querySnapshot) => {\r\n      const batch = database.batch();\r\n      const outOfStock = [];\r\n\r\n      querySnapshot.docs.forEach((docSnapshot, id) => {\r\n        if (docSnapshot.data().stock >= aggregateItems[id].itemCount) {\r\n          batch.update(docSnapshot.ref, {\r\n            stock: docSnapshot.data().stock - aggregateItems[id].itemCount,\r\n          });\r\n        } else {\r\n          outOfStock.push({ ...docSnapshot.data(), id: docSnapshot.id });\r\n        }\r\n      });\r\n\r\n      if (outOfStock.length === 0) {\r\n        batch.commit().then(() => {\r\n          database\r\n            .collection(\"orders\")\r\n            .orderBy(\"date\", \"desc\")\r\n            .limit(1)\r\n            .get()\r\n            .then((querySnapshot) => {\r\n              setOrderNumber(querySnapshot.docs[0].id);\r\n              addNewOrder(buyer);\r\n              setRedirect(true);\r\n              clear();\r\n            });\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {redirect ? (\r\n        <Redirect to={`/purchaseMade/${orderNumber}`} />\r\n      ) : (\r\n        <form onSubmit={createOrder}>\r\n          <p>\r\n            <label>Nombre:</label>\r\n            <br></br>\r\n            <input\r\n              value={name}\r\n              onChange={(e) => setName(e.target.value)}\r\n              placeholder=\"Tomas Martinez\"\r\n              id=\"name\"\r\n              type=\"text\"\r\n              autoComplete=\"name\"\r\n              enterKeyHint=\"next\"\r\n              required\r\n              autoFocus\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Teléfono:</label>\r\n            <br></br>\r\n            <input\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              placeholder=\"+54 261 542389\"\r\n              id=\"phone\"\r\n              type=\"tel\"\r\n              autoComplete=\"phone\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Mail:</label>\r\n            <br></br>\r\n            <input\r\n              value={mail}\r\n              onChange={(e) => setMail(e.target.value)}\r\n              placeholder=\"ejemplo@ejemplo.com\"\r\n              id=\"mail\"\r\n              type=\"email\"\r\n              autoComplete=\"email\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <button\r\n            className=\"btn btn-outline-success\"\r\n            type=\"submit\"\r\n            disabled={name === \"\" || phone === \"\" || mail === \"\"}\r\n          >\r\n            Finalizar Compra\r\n          </button>\r\n        </form>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}