{"ast":null,"code":"var _jsxFileName = \"C:\\\\wamp64\\\\www\\\\tienda-martinez\\\\src\\\\components\\\\cart\\\\Form.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport { database } from \"../../firebase/firebase\";\nimport firebase from \"firebase/app\";\nimport \"firebase/firestore\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const Form = ({\n  aggregateItems,\n  itemsPrice,\n  clear\n}) => {\n  _s();\n\n  const [name, setName] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [mail, setMail] = useState(\"\");\n  const [redirect, setRedirect] = useState(false);\n  const [orderNumber, setOrderNumber] = useState(\"\");\n\n  const createOrder = e => {\n    e.preventDefault();\n    const buyer = {\n      name: name,\n      phone: phone,\n      mail: mail\n    };\n    const itemsToUpdate = database.collection(\"products\").where(firebase.firestore.FieldPath.documentId(), \"in\", aggregateItems.map(i => i.smartwatch.id));\n\n    const addNewOrder = buyer => {\n      const newOrder = createOrder(buyer);\n      const orders = dataBase.collection(\"orders\");\n\n      try {\n        orders.add(newOrder).then(doc => {\n          setShowForm(false);\n          updateOrderData(doc.id);\n        });\n      } catch (error) {\n        setError(true);\n      }\n    };\n\n    itemsToUpdate.get().then(querySnapshot => {\n      const batch = database.batch();\n      const outOfStock = [];\n      querySnapshot.docs.forEach((docSnapshot, id) => {\n        if (docSnapshot.data().stock >= aggregateItems[id].itemCount) {\n          batch.update(docSnapshot.ref, {\n            stock: docSnapshot.data().stock - aggregateItems[id].itemCount\n          });\n        } else {\n          outOfStock.push({ ...docSnapshot.data(),\n            id: docSnapshot.id\n          });\n        }\n      });\n\n      if (outOfStock.length === 0) {\n        /* const newOrderReference = database.collection(\"orders\").doc();\r\n          const orderItems = aggregateItems.map((item) => {\r\n          return {\r\n            id: item.smartwatch.id,\r\n            title: item.smartwatch.name,\r\n            price: item.smartwatch.price,\r\n            qty: item.itemCount,\r\n          };\r\n        });\r\n          batch.set(newOrderReference, {\r\n          buyer: buyer,\r\n          items: orderItems,\r\n          date: firebase.firestore.Timestamp.fromDate(new Date()),\r\n          total: itemsPrice,\r\n        });\r\n          batch.commit().then(() => {\r\n          database\r\n            .collection(\"orders\")\r\n            .orderBy(\"date\", \"desc\")\r\n            .limit(1)\r\n            .get()\r\n            .then((querySnapshot) => {\r\n              setOrderNumber(querySnapshot.docs[0].id);\r\n              setRedirect(true);\r\n              clear();\r\n            });\r\n        }); */\n        batch.commit().then(() => {\n          addNewOrder(buyer);\n        });\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: redirect ? alert(`Orden realizada con éxito ${orderNumber}`) : /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: createOrder,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Nombre:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: name,\n          onChange: e => setName(e.target.value),\n          placeholder: \"Tomas Martinez\",\n          id: \"name\",\n          type: \"text\",\n          autoComplete: \"name\",\n          enterKeyHint: \"next\",\n          required: true,\n          autoFocus: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Tel\\xE9fono:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: phone,\n          onChange: e => setPhone(e.target.value),\n          placeholder: \"+54 261 542389\",\n          id: \"phone\",\n          type: \"tel\",\n          autoComplete: \"phone\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Mail:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: mail,\n          onChange: e => setMail(e.target.value),\n          placeholder: \"ejemplo@ejemplo.com\",\n          id: \"mail\",\n          type: \"email\",\n          autoComplete: \"email\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn btn-outline-success\",\n        type: \"submit\",\n        disabled: name === \"\" || phone === \"\" || mail === \"\",\n        children: \"Finalizar Compra\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(Form, \"upwIg/CtU0EgBCBbjkUIk/c0xcY=\");\n\n_c = Form;\n\nvar _c;\n\n$RefreshReg$(_c, \"Form\");","map":{"version":3,"sources":["C:/wamp64/www/tienda-martinez/src/components/cart/Form.jsx"],"names":["React","useState","database","firebase","Form","aggregateItems","itemsPrice","clear","name","setName","phone","setPhone","mail","setMail","redirect","setRedirect","orderNumber","setOrderNumber","createOrder","e","preventDefault","buyer","itemsToUpdate","collection","where","firestore","FieldPath","documentId","map","i","smartwatch","id","addNewOrder","newOrder","orders","dataBase","add","then","doc","setShowForm","updateOrderData","error","setError","get","querySnapshot","batch","outOfStock","docs","forEach","docSnapshot","data","stock","itemCount","update","ref","push","length","commit","alert","target","value"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport { database } from \"../../firebase/firebase\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\n\r\nexport const Form = ({ aggregateItems, itemsPrice, clear }) => {\r\n  const [name, setName] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [mail, setMail] = useState(\"\");\r\n  const [redirect, setRedirect] = useState(false);\r\n  const [orderNumber, setOrderNumber] = useState(\"\");\r\n\r\n  const createOrder = (e) => {\r\n    e.preventDefault();\r\n\r\n    const buyer = {\r\n      name: name,\r\n      phone: phone,\r\n      mail: mail,\r\n    };\r\n\r\n    const itemsToUpdate = database.collection(\"products\").where(\r\n      firebase.firestore.FieldPath.documentId(),\r\n      \"in\",\r\n      aggregateItems.map((i) => i.smartwatch.id)\r\n    );\r\n\r\n    const addNewOrder = (buyer) => {\r\n      const newOrder = createOrder(buyer);\r\n      const orders = dataBase.collection(\"orders\");\r\n      try {\r\n        orders.add(newOrder).then((doc) => {\r\n          setShowForm(false);\r\n          updateOrderData(doc.id);\r\n        });\r\n      } catch (error) {\r\n        setError(true);\r\n      }\r\n    };\r\n\r\n    itemsToUpdate.get().then((querySnapshot) => {\r\n      const batch = database.batch();\r\n      const outOfStock = [];\r\n\r\n      querySnapshot.docs.forEach((docSnapshot, id) => {\r\n        if (docSnapshot.data().stock >= aggregateItems[id].itemCount) {\r\n          batch.update(docSnapshot.ref, {\r\n            stock: docSnapshot.data().stock - aggregateItems[id].itemCount,\r\n          });\r\n        } else {\r\n          outOfStock.push({ ...docSnapshot.data(), id: docSnapshot.id });\r\n        }\r\n      });\r\n\r\n      if (outOfStock.length === 0) {\r\n        /* const newOrderReference = database.collection(\"orders\").doc();\r\n\r\n        const orderItems = aggregateItems.map((item) => {\r\n          return {\r\n            id: item.smartwatch.id,\r\n            title: item.smartwatch.name,\r\n            price: item.smartwatch.price,\r\n            qty: item.itemCount,\r\n          };\r\n        });\r\n\r\n        batch.set(newOrderReference, {\r\n          buyer: buyer,\r\n          items: orderItems,\r\n          date: firebase.firestore.Timestamp.fromDate(new Date()),\r\n          total: itemsPrice,\r\n        });\r\n\r\n        batch.commit().then(() => {\r\n          database\r\n            .collection(\"orders\")\r\n            .orderBy(\"date\", \"desc\")\r\n            .limit(1)\r\n            .get()\r\n            .then((querySnapshot) => {\r\n              setOrderNumber(querySnapshot.docs[0].id);\r\n              setRedirect(true);\r\n              clear();\r\n            });\r\n        }); */\r\n        batch.commit().then(() => {\r\n          addNewOrder(buyer);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {redirect ? (\r\n        alert(`Orden realizada con éxito ${orderNumber}`)\r\n      ) : (\r\n        <form onSubmit={createOrder}>\r\n          <p>\r\n            <label>Nombre:</label>\r\n            <br></br>\r\n            <input\r\n              value={name}\r\n              onChange={(e) => setName(e.target.value)}\r\n              placeholder=\"Tomas Martinez\"\r\n              id=\"name\"\r\n              type=\"text\"\r\n              autoComplete=\"name\"\r\n              enterKeyHint=\"next\"\r\n              required\r\n              autoFocus\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Teléfono:</label>\r\n            <br></br>\r\n            <input\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              placeholder=\"+54 261 542389\"\r\n              id=\"phone\"\r\n              type=\"tel\"\r\n              autoComplete=\"phone\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Mail:</label>\r\n            <br></br>\r\n            <input\r\n              value={mail}\r\n              onChange={(e) => setMail(e.target.value)}\r\n              placeholder=\"ejemplo@ejemplo.com\"\r\n              id=\"mail\"\r\n              type=\"email\"\r\n              autoComplete=\"email\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <button\r\n            className=\"btn btn-outline-success\"\r\n            type=\"submit\"\r\n            disabled={name === \"\" || phone === \"\" || mail === \"\"}\r\n          >\r\n            Finalizar Compra\r\n          </button>\r\n        </form>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}