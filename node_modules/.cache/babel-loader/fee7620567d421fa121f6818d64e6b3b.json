{"ast":null,"code":"var _jsxFileName = \"C:\\\\wamp64\\\\www\\\\tienda-martinez\\\\src\\\\components\\\\cart\\\\Form.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext } from \"react\";\nimport { database } from \"../../firebase/firebase\";\nimport { CartContext } from \"../../context/CartContext\";\nimport firebase from \"firebase/app\";\nimport \"firebase/firestore\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const Form = ({\n  aggregateItems,\n  itemsPrice,\n  clear\n}) => {\n  _s();\n\n  const {\n    updateOrderData\n  } = useContext(CartContext);\n  const [name, setName] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [mail, setMail] = useState(\"\");\n  const [redirect, setRedirect] = useState(false);\n  const [orderNumber, setOrderNumber] = useState(\"\");\n  const [error, setError] = useState(false);\n\n  const createOrder = e => {\n    e.preventDefault();\n    const buyer = {\n      name: name,\n      phone: phone,\n      mail: mail\n    };\n    const itemsToUpdate = database.collection(\"products\").where(firebase.firestore.FieldPath.documentId(), \"in\", aggregateItems.map(i => i.smartwatch.id));\n\n    const createOrder = buyer => {\n      const newOrder = {\n        buyer: buyer,\n        items: aggregateItems,\n        date: firebase.firestore.Timestamp.fromDate(new Date()),\n        total: itemsPrice\n      };\n      return newOrder;\n    };\n\n    const addNewOrder = buyer => {\n      const newOrder = createOrder(buyer);\n      const orders = database.collection(\"orders\");\n\n      try {\n        orders.add(newOrder).then(doc => {\n          updateOrderData(doc.id);\n        });\n      } catch (error) {\n        setError(true);\n      }\n    };\n\n    itemsToUpdate.get().then(querySnapshot => {\n      const batch = database.batch();\n      const outOfStock = [];\n      querySnapshot.docs.forEach((docSnapshot, id) => {\n        if (docSnapshot.data().stock >= aggregateItems[id].itemCount) {\n          batch.update(docSnapshot.ref, {\n            stock: docSnapshot.data().stock - aggregateItems[id].itemCount\n          });\n        } else {\n          outOfStock.push({ ...docSnapshot.data(),\n            id: docSnapshot.id\n          });\n        }\n      });\n\n      if (outOfStock.length === 0) {\n        batch.commit().then(() => {\n          database.collection(\"orders\").orderBy(\"date\", \"desc\").limit(1).get().then(querySnapshot => {\n            setOrderNumber(querySnapshot.docs[0].id);\n            addNewOrder(buyer);\n            clear();\n          });\n        });\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: redirect ? alert(`Orden realizada con éxito ${orderNumber}`) : /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: createOrder,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Nombre:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: name,\n          onChange: e => setName(e.target.value),\n          placeholder: \"Tomas Martinez\",\n          id: \"name\",\n          type: \"text\",\n          autoComplete: \"name\",\n          enterKeyHint: \"next\",\n          required: true,\n          autoFocus: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Tel\\xE9fono:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: phone,\n          onChange: e => setPhone(e.target.value),\n          placeholder: \"+54 261 542389\",\n          id: \"phone\",\n          type: \"tel\",\n          autoComplete: \"phone\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Mail:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: mail,\n          onChange: e => setMail(e.target.value),\n          placeholder: \"ejemplo@ejemplo.com\",\n          id: \"mail\",\n          type: \"email\",\n          autoComplete: \"email\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn btn-outline-success\",\n        type: \"submit\",\n        disabled: name === \"\" || phone === \"\" || mail === \"\",\n        children: \"Finalizar Compra\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(Form, \"soIVJaaQuK2rhn6o/IVyV0M1D8M=\");\n\n_c = Form;\n\nvar _c;\n\n$RefreshReg$(_c, \"Form\");","map":{"version":3,"sources":["C:/wamp64/www/tienda-martinez/src/components/cart/Form.jsx"],"names":["React","useState","useContext","database","CartContext","firebase","Form","aggregateItems","itemsPrice","clear","updateOrderData","name","setName","phone","setPhone","mail","setMail","redirect","setRedirect","orderNumber","setOrderNumber","error","setError","createOrder","e","preventDefault","buyer","itemsToUpdate","collection","where","firestore","FieldPath","documentId","map","i","smartwatch","id","newOrder","items","date","Timestamp","fromDate","Date","total","addNewOrder","orders","add","then","doc","get","querySnapshot","batch","outOfStock","docs","forEach","docSnapshot","data","stock","itemCount","update","ref","push","length","commit","orderBy","limit","alert","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from \"react\";\r\nimport { database } from \"../../firebase/firebase\";\r\nimport { CartContext } from \"../../context/CartContext\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\n\r\nexport const Form = ({ aggregateItems, itemsPrice, clear }) => {\r\n  const { updateOrderData } = useContext(CartContext);\r\n  const [name, setName] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [mail, setMail] = useState(\"\");\r\n  const [redirect, setRedirect] = useState(false);\r\n  const [orderNumber, setOrderNumber] = useState(\"\");\r\n  const [error, setError] = useState(false);\r\n\r\n  const createOrder = (e) => {\r\n    e.preventDefault();\r\n\r\n    const buyer = {\r\n      name: name,\r\n      phone: phone,\r\n      mail: mail,\r\n    };\r\n\r\n    const itemsToUpdate = database.collection(\"products\").where(\r\n      firebase.firestore.FieldPath.documentId(),\r\n      \"in\",\r\n      aggregateItems.map((i) => i.smartwatch.id)\r\n    );\r\n\r\n    const createOrder = (buyer) => {\r\n      const newOrder = {\r\n        buyer: buyer,\r\n        items: aggregateItems,\r\n        date: firebase.firestore.Timestamp.fromDate(new Date()),\r\n        total: itemsPrice,\r\n      };\r\n      return newOrder;\r\n    };\r\n\r\n    const addNewOrder = (buyer) => {\r\n      const newOrder = createOrder(buyer);\r\n      const orders = database.collection(\"orders\");\r\n      try {\r\n        orders.add(newOrder).then((doc) => {\r\n          updateOrderData(doc.id);\r\n        });\r\n      } catch (error) {\r\n        setError(true);\r\n      }\r\n    };\r\n\r\n    itemsToUpdate.get().then((querySnapshot) => {\r\n      const batch = database.batch();\r\n      const outOfStock = [];\r\n\r\n      querySnapshot.docs.forEach((docSnapshot, id) => {\r\n        if (docSnapshot.data().stock >= aggregateItems[id].itemCount) {\r\n          batch.update(docSnapshot.ref, {\r\n            stock: docSnapshot.data().stock - aggregateItems[id].itemCount,\r\n          });\r\n        } else {\r\n          outOfStock.push({ ...docSnapshot.data(), id: docSnapshot.id });\r\n        }\r\n      });\r\n\r\n      if (outOfStock.length === 0) {\r\n        batch.commit().then(() => {\r\n          database\r\n            .collection(\"orders\")\r\n            .orderBy(\"date\", \"desc\")\r\n            .limit(1)\r\n            .get()\r\n            .then((querySnapshot) => {\r\n              setOrderNumber(querySnapshot.docs[0].id);\r\n              addNewOrder(buyer);\r\n              clear();\r\n            });\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {redirect ? (\r\n        alert(`Orden realizada con éxito ${orderNumber}`)\r\n      ) : (\r\n        <form onSubmit={createOrder}>\r\n          <p>\r\n            <label>Nombre:</label>\r\n            <br></br>\r\n            <input\r\n              value={name}\r\n              onChange={(e) => setName(e.target.value)}\r\n              placeholder=\"Tomas Martinez\"\r\n              id=\"name\"\r\n              type=\"text\"\r\n              autoComplete=\"name\"\r\n              enterKeyHint=\"next\"\r\n              required\r\n              autoFocus\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Teléfono:</label>\r\n            <br></br>\r\n            <input\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              placeholder=\"+54 261 542389\"\r\n              id=\"phone\"\r\n              type=\"tel\"\r\n              autoComplete=\"phone\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Mail:</label>\r\n            <br></br>\r\n            <input\r\n              value={mail}\r\n              onChange={(e) => setMail(e.target.value)}\r\n              placeholder=\"ejemplo@ejemplo.com\"\r\n              id=\"mail\"\r\n              type=\"email\"\r\n              autoComplete=\"email\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <button\r\n            className=\"btn btn-outline-success\"\r\n            type=\"submit\"\r\n            disabled={name === \"\" || phone === \"\" || mail === \"\"}\r\n          >\r\n            Finalizar Compra\r\n          </button>\r\n        </form>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}