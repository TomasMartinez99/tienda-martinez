{"ast":null,"code":"var _jsxFileName = \"C:\\\\wamp64\\\\www\\\\tienda-martinez\\\\src\\\\components\\\\cart\\\\Form.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport { database } from \"../../firebase/firebase\";\nimport firebase from \"firebase/app\";\nimport \"firebase/firestore\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const Form = ({\n  aggregateItems,\n  itemsPrice,\n  clear\n}) => {\n  _s();\n\n  const [name, setName] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [mail, setMail] = useState(\"\");\n  const [redirect, setRedirect] = useState(false);\n  const [orderNumber, setOrderNumber] = useState(\"\");\n\n  const createOrder = e => {\n    e.preventDefault();\n    const buyer = {\n      name: name,\n      phone: phone,\n      mail: mail\n    };\n    const itemsToUpdate = database.collection(\"products\").where(firebase.firestore.FieldPath.documentId(), \"in\", aggregateItems.map(i => i.smartwatch.id));\n    itemsToUpdate.get().then(querySnapshot => {\n      const batch = database.batch();\n      const outOfStock = [];\n      querySnapshot.docs.forEach((docSnapshot, id) => {\n        if (docSnapshot.data().stock >= aggregateItems[id].itemCount) {\n          batch.update(docSnapshot.ref, {\n            stock: docSnapshot.data().stock - aggregateItems[id].itemCount\n          });\n        } else {\n          outOfStock.push({ ...docSnapshot.data(),\n            id: docSnapshot.id\n          });\n        }\n      });\n\n      if (outOfStock.length === 0) {\n        const newOrderReference = database.collection(\"orders\").doc();\n        const orderItems = aggregateItems.map(item => {\n          return {\n            id: item.smartwatch.itemToShow.id,\n            title: item.smartwatch.itemToShow.name,\n            price: item.smartwatch.itemToShow.price,\n            qty: item.itemCount\n          };\n        });\n        batch.set(newOrderReference, {\n          buyer: buyer,\n          items: orderItems,\n          date: firebase.firestore.Timestamp.fromDate(new Date()),\n          total: itemsPrice\n        });\n        batch.commit().then(() => {\n          database.collection(\"orders\").orderBy(\"date\", \"desc\").limit(1).get().then(querySnapshot => {\n            setOrderNumber(querySnapshot.docs[0].id);\n            setRedirect(true);\n            clear();\n          });\n        });\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: redirect ? alert(`Orden realizada con éxito ${orderNumber}`) : /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: createOrder,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Nombre:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: name,\n          onChange: e => setName(e.target.value),\n          placeholder: \"Tomas Martinez\",\n          id: \"name\",\n          type: \"text\",\n          autoComplete: \"name\",\n          enterKeyHint: \"next\",\n          required: true,\n          autoFocus: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Tel\\xE9fono:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: phone,\n          onChange: e => setPhone(e.target.value),\n          placeholder: \"+54 261 542389\",\n          id: \"phone\",\n          type: \"tel\",\n          autoComplete: \"phone\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Mail:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: mail,\n          onChange: e => setMail(e.target.value),\n          placeholder: \"ejemplo@ejemplo.com\",\n          id: \"mail\",\n          type: \"email\",\n          autoComplete: \"email\",\n          enterKeyHint: \"next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn btn-outline-success\",\n        type: \"submit\",\n        disabled: name === \"\" || phone === \"\" || mail === \"\",\n        children: \"Finalizar Compra\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(Form, \"upwIg/CtU0EgBCBbjkUIk/c0xcY=\");\n\n_c = Form;\n\nvar _c;\n\n$RefreshReg$(_c, \"Form\");","map":{"version":3,"sources":["C:/wamp64/www/tienda-martinez/src/components/cart/Form.jsx"],"names":["React","useState","database","firebase","Form","aggregateItems","itemsPrice","clear","name","setName","phone","setPhone","mail","setMail","redirect","setRedirect","orderNumber","setOrderNumber","createOrder","e","preventDefault","buyer","itemsToUpdate","collection","where","firestore","FieldPath","documentId","map","i","smartwatch","id","get","then","querySnapshot","batch","outOfStock","docs","forEach","docSnapshot","data","stock","itemCount","update","ref","push","length","newOrderReference","doc","orderItems","item","itemToShow","title","price","qty","set","items","date","Timestamp","fromDate","Date","total","commit","orderBy","limit","alert","target","value"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport { database } from \"../../firebase/firebase\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\n\r\nexport const Form = ({ aggregateItems, itemsPrice, clear }) => {\r\n  const [name, setName] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [mail, setMail] = useState(\"\");\r\n  const [redirect, setRedirect] = useState(false);\r\n  const [orderNumber, setOrderNumber] = useState(\"\");\r\n\r\n  const createOrder = (e) => {\r\n    e.preventDefault();\r\n\r\n    const buyer = {\r\n      name: name,\r\n      phone: phone,\r\n      mail: mail,\r\n    };\r\n\r\n    const itemsToUpdate = database.collection(\"products\").where(\r\n      firebase.firestore.FieldPath.documentId(),\r\n      \"in\",\r\n      aggregateItems.map((i) => i.smartwatch.id)\r\n    );\r\n\r\n    itemsToUpdate.get().then((querySnapshot) => {\r\n      const batch = database.batch();\r\n      const outOfStock = [];\r\n\r\n      querySnapshot.docs.forEach((docSnapshot, id) => {\r\n        if (docSnapshot.data().stock >= aggregateItems[id].itemCount) {\r\n          batch.update(docSnapshot.ref, {\r\n            stock: docSnapshot.data().stock - aggregateItems[id].itemCount,\r\n          });\r\n        } else {\r\n          outOfStock.push({ ...docSnapshot.data(), id: docSnapshot.id });\r\n        }\r\n      });\r\n\r\n      if (outOfStock.length === 0) {\r\n        const newOrderReference = database.collection(\"orders\").doc();\r\n\r\n        const orderItems = aggregateItems.map((item) => {\r\n          return {\r\n            id: item.smartwatch.itemToShow.id,\r\n            title: item.smartwatch.itemToShow.name,\r\n            price: item.smartwatch.itemToShow.price,\r\n            qty: item.itemCount,\r\n          };\r\n        });\r\n\r\n        batch.set(newOrderReference, {\r\n          buyer: buyer,\r\n          items: orderItems,\r\n          date: firebase.firestore.Timestamp.fromDate(new Date()),\r\n          total: itemsPrice,\r\n        });\r\n\r\n        batch.commit().then(() => {\r\n          database\r\n            .collection(\"orders\")\r\n            .orderBy(\"date\", \"desc\")\r\n            .limit(1)\r\n            .get()\r\n            .then((querySnapshot) => {\r\n              setOrderNumber(querySnapshot.docs[0].id);\r\n              setRedirect(true);\r\n              clear();\r\n            });\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {redirect ? (\r\n        alert(`Orden realizada con éxito ${orderNumber}`)\r\n      ) : (\r\n        <form onSubmit={createOrder}>\r\n          <p>\r\n            <label>Nombre:</label>\r\n            <br></br>\r\n            <input\r\n              value={name}\r\n              onChange={(e) => setName(e.target.value)}\r\n              placeholder=\"Tomas Martinez\"\r\n              id=\"name\"\r\n              type=\"text\"\r\n              autoComplete=\"name\"\r\n              enterKeyHint=\"next\"\r\n              required\r\n              autoFocus\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Teléfono:</label>\r\n            <br></br>\r\n            <input\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              placeholder=\"+54 261 542389\"\r\n              id=\"phone\"\r\n              type=\"tel\"\r\n              autoComplete=\"phone\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <p>\r\n            <label>Mail:</label>\r\n            <br></br>\r\n            <input\r\n              value={mail}\r\n              onChange={(e) => setMail(e.target.value)}\r\n              placeholder=\"ejemplo@ejemplo.com\"\r\n              id=\"mail\"\r\n              type=\"email\"\r\n              autoComplete=\"email\"\r\n              enterKeyHint=\"next\"\r\n            />\r\n          </p>\r\n          <button\r\n            className=\"btn btn-outline-success\"\r\n            type=\"submit\"\r\n            disabled={name === \"\" || phone === \"\" || mail === \"\"}\r\n          >\r\n            Finalizar Compra\r\n          </button>\r\n        </form>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}